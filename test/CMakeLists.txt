FIND_PACKAGE(
	Boost 1.41.0 REQUIRED COMPONENTS
	unit_test_framework
)

ENABLE_TESTING()

MACRO(
	ADD_FCPPT_TEST
	PATHNAME
)
	STRING(REGEX REPLACE "\\/" "_" TESTNAME ${PATHNAME})

	ADD_EXECUTABLE (${TESTNAME} ${PATHNAME}.cpp)

	IF(MSVC)
		SET_PROPERTY(
			TARGET ${TESTNAME}
			PROPERTY COMPILE_FLAGS
			"-DBOOST_TEST_NO_LIB -DBOOST_TEST_MODULE=${TESTNAME}"
		)
	ELSE()
		SET_PROPERTY(
			TARGET ${TESTNAME}
			PROPERTY COMPILE_FLAGS
			"-DBOOST_TEST_DYN_LINK -DBOOST_TEST_MODULE=${TESTNAME}"
		)
	ENDIF()

	TARGET_LINK_LIBRARIES (${TESTNAME} fcppt ${Boost_UNIT_TEST_FRAMEWORK_LIBRARY})

	ADD_TEST(NAME ${TESTNAME} COMMAND ${TESTNAME})

	SET (TEST_NAMES "${TEST_NAMES} ${TESTNAME}")
ENDMACRO()

ADD_FCPPT_TEST(chrono/monotonic)
ADD_FCPPT_TEST(chrono/duration)

ADD_CUSTOM_TARGET(
	test COMMAND
	${CMAKE_CTEST_COMMAND}
	#DEPENDS ${TEST_NAMES}
)
